# Youtube Killer

## Архітектурна схема.

Інфраструктура системи будується на **AWS**.
![image](https://user-images.githubusercontent.com/56489476/207767140-dfc331a0-514d-4cb7-8c17-b5c05e2c482a.png)
## Перелік мікросервісів.
  1. Мікросервіс рекомедацій та пошуку.
    Відповідає за рекомендації відео та їх пошук.
  3. Відео мікросервіс.
    Відповідає за CRUD операції.
  5. Мікросервіс автентифікації.
    Відповідає за автентифікацію до системи.
  7. Мікросервіс каналів.
    Відповідає за CRUD, підписку та завантаження відео.
## Перелік залежностей.
- Для зберігання та відтворення відео ми використовуємо S3, Cloudfront та AWS Elemental MediaLive.
- Для зберігання користувачів — Amazon RDS(MySQL). БД має одну таблицю, де міститься (id, email, pass).
- Для зберігання каналів — MongoDB зі схемою:
    ```
    {
       channel_id,
       credentials: {
          email,
          pass
       },
       name,
       creation_date,
       country,

       subscribers: [user_id...],
       videos: [video_id...]
    }
    ```
- Для кешування запитів пошуку — ElastiCache.
- Для пошуку, формування рекомендацій та зберігання інформації про відео — Open Search зі схемою:
    ```
    {
       video_id,
       name,
       tags[tag...],
       categories: [category...],
       description,
       s3_url,
       upload_date,
       users:[
         {
            user_id,
            like-dislike,
            comment
         }
       ]
    }
    ```
## Опис залежностей.
- **Запит на API Gateway** — направляє його до потрібного мікросервісу.
- **Отримати рекомендаціїї** — мікросервіс звертається до _Open Search_ і отримує ранжовані дані з бази даних Open Search. Сервіс налаштований так, щоб видавати рекомендації згідно наших бізнес вимог.
- **Знайти відео** — звертаємося в кеш, якщо не знайшли, тоді до _Open Search_, отримуємо результати, записуємо їх в кеш і повертаємо.
- **Завантаження відео** — отримуємо інформацію про відео і бінарний файл від користувача в **Channel microservice**. Надсилаємо усе до **Video microservice**. Записуємо файл — в _S3_. Після записуємо **url** від _S3_ разом з інформацією, яку отримали від користувача в **Open Search**, а **video_id** який отримали від _OpenSearch_, в масив **videos** в каналах. В кінці надсилаємо сповіщення на пошту та push на мобільні пристрої підписаних на канал користувачів за допомогою _Amazon SNS_.
- **Перегляд відео** — **Video microservice** отримує запит від користувача, дістає інформацію разом з посилання з бази _Open Search_, конструює посилання для _Cloudfront_. _AWS Elemental Media Live_ бере відео з _S3_, перетворює його в MPTS та передає Cloudfront. Таким чином з url від cdn користувач отримує можливість переглядати video-on-demand. 
- **Автентифікація** — Для автентифікації генеруватимемо jwt token, якщо облікові дані будуть правильними. Також надсилаємо повідомлення про логін через _Amazon SNS_.
- **Реєстрація** — Коли користувач реєструється — ми перевіряємо чи існує такий вже, якщо ні — створюємо для нього канал в **Channel microservice**. Після отримуємо **channel_id** створеного каналу та записуємо об'єкт **credentials** в БД. Далі надсилаємо повідомлення про реєстрацію через _Amazon SNS_. 
- **Підписка** — Отримуємо запит від користувача з **user_id** та **channel_id**, перевіряємо та додаємо його до **subscribers** в об'єкті **channel**.
